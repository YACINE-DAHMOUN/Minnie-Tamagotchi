// Variables globales
let hangry = 50;
let energy = 50;
let happy = 50;
let isSleeping = false;
let isDead = false;

// √âl√©ments DOM
let minnieElement;
let spanEnergy;
let spanHappy;
let spanHangry;
let spanMessage;
let hangryBar;
let energyBar;
let happyBar;
let boutonDormir;
let boutonManger;
let boutonJouer;

// Initialisation
document.addEventListener('DOMContentLoaded', function() {
    // R√©cup√©ration des √©l√©ments
    minnieElement = document.getElementById('minnie');
    spanEnergy = document.getElementById('energy');
    spanHappy = document.getElementById('happy');
    spanHangry = document.getElementById('hangry');
    spanMessage = document.getElementById('message');
    hangryBar = document.getElementById('hangry-bar');
    energyBar = document.getElementById('energy-bar');
    happyBar = document.getElementById('happy-bar');
    boutonDormir = document.querySelector('.sleep-btn');
    boutonManger = document.querySelector('.eat-btn');
    boutonJouer = document.querySelector('.play-button');

    // V√©rification des √©l√©ments
    if (!minnieElement || !spanEnergy || !spanHappy || !spanHangry || !spanMessage) {
        console.error('Erreur: √âl√©ments DOM manquants');
        return;
    }

    // √âv√©nements des boutons
    if (boutonDormir) boutonDormir.addEventListener('click', sleeping);
    if (boutonManger) boutonManger.addEventListener('click', eating);
    if (boutonJouer) boutonJouer.addEventListener('click', playing);

    // Initialisation
    updateDisplay();
    showMessage("Bonjour ! Je suis Minnie ! üéÄ", 'success');
    startLifeSystem();
});

// Limiter les valeurs entre 0 et 100
function clampValue(value) {
    return Math.max(0, Math.min(100, value));
}

// Mise √† jour de l'affichage
function updateDisplay() {
    // Limiter les valeurs
    hangry = clampValue(hangry);
    energy = clampValue(energy);
    happy = clampValue(happy);

    // Mettre √† jour les textes
    spanHangry.textContent = hangry;
    spanEnergy.textContent = energy;
    spanHappy.textContent = happy;

    // Mettre √† jour les barres de statut
    updateStatusBars();
    updateStatColors();
}

// Mise √† jour des barres de statut
function updateStatusBars() {
    if (hangryBar) {
        hangryBar.style.width = hangry + '%';
        hangryBar.style.backgroundColor = getStatColor(hangry);
    }
    if (energyBar) {
        energyBar.style.width = energy + '%';
        energyBar.style.backgroundColor = getStatColor(energy);
    }
    if (happyBar) {
        happyBar.style.width = happy + '%';
        happyBar.style.backgroundColor = getStatColor(happy);
    }
}

// Obtenir la couleur selon la valeur
function getStatColor(value) {
    if (value >= 70) return '#32cd32';
    if (value >= 40) return '#ffa500';
    if (value >= 20) return '#ff4500';
    return '#dc143c';
}

// Mise √† jour des couleurs des stats
function updateStatColors() {
    const spans = [spanHangry, spanEnergy, spanHappy];
    const values = [hangry, energy, happy];
    
    spans.forEach((span, index) => {
        if (!span) return;
        const value = values[index];
        span.className = '';
        
        if (value >= 70) span.className = 'stat-high';
        else if (value >= 40) span.className = 'stat-medium';
        else if (value >= 20) span.className = 'stat-low';
        else span.className = 'stat-critical';
    });
}

// Syst√®me de vie
function lifeSystem() {
    if (isSleeping || isDead) return;

    hangry -= 3;
    energy -= 2;
    happy -= 2;

    checkCriticalState();
    checkDeath();
    updateDisplay();
}

// V√©rifier l'√©tat critique
function checkCriticalState() {
    if (hangry <= 15 && hangry > 0) {
        showMessage("Minnie a tr√®s faim ! üçé", 'danger');
    } else if (energy <= 15 && energy > 0) {
        showMessage("Minnie est tr√®s fatigu√©e ! üò¥", 'danger');
    } else if (happy <= 15 && happy > 0) {
        showMessage("Minnie est tr√®s triste ! üò¢", 'danger');
    }
}

// V√©rifier la mort
function checkDeath() {
    if (hangry <= 0 || energy <= 0 || happy <= 0) {
        isDead = true;
        showMessage("Oh non ! Minnie s'est √©vanouie ! Prenez mieux soin d'elle ! üíî", 'danger');
        minnieElement.style.filter = 'grayscale(100%)';
        disableButtons();
        
        // Permettre la r√©surrection apr√®s 10 secondes
        setTimeout(() => {
            revive();
        }, 10000);
    }
}

// R√©animer Minnie
function revive() {
    isDead = false;
    hangry = 30;
    energy = 30;
    happy = 30;
    minnieElement.style.filter = 'none';
    enableButtons();
    showMessage("Minnie s'est r√©veill√©e ! Elle vous pardonne ! üíñ", 'success');
    updateDisplay();
}

// Afficher un message
function showMessage(message, type = 'info') {
    if (!spanMessage) return;
    
    spanMessage.textContent = message;
    spanMessage.className = `message-${type}`;
    
    // Effacer le message apr√®s 4 secondes
    setTimeout(() => {
        spanMessage.textContent = '';
        spanMessage.className = '';
    }, 4000);
}

// Dormir
function sleeping() {
    if (isDead) return;
    
    if (isSleeping) {
        showMessage("Minnie dort d√©j√† ! üò¥", 'warning');
        return;
    }

    // Messages vari√©s pour dormir
    const sleepMessages = [
        "Minnie fait dodo... üí§",
        "Bonne nuit Minnie ! üåô",
        "Minnie s'endort paisiblement... üò¥",
        "Doux r√™ves Minnie ! ‚ú®",
        "Minnie compte les moutons... üêë"
    ];
    
    const wakeMessages = [
        "Minnie s'est r√©veill√©e ! Elle se sent mieux ! üåü",
        "Bonjour Minnie ! Bien repos√©e ? ‚òÄÔ∏è",
        "Minnie a fait de beaux r√™ves ! üí≠",
        "Minnie se r√©veille en pleine forme ! üí™",
        "Minnie √©tire ses petits bras ! ü§ó"
    ];
    
    const randomSleepMessage = sleepMessages[Math.floor(Math.random() * sleepMessages.length)];
    showMessage(randomSleepMessage, 'info');
    isSleeping = true;
    
    // Animation de sommeil
    minnieElement.classList.remove('bounce', 'shake', 'pulse', 'spin', 'dance', 'wiggle', 'jump', 'flip', 'heartbeat', 'rainbow');
    minnieElement.classList.add('sleep');
    
    // D√©sactiver les boutons pendant le sommeil
    disableButtons();

    // Restaurer l'√©nergie progressivement
    const sleepInterval = setInterval(() => {
        if (energy < 100) {
            energy += 2;
            updateDisplay();
        }
    }, 200);

    // R√©veiller apr√®s 5 secondes
    setTimeout(() => {
        clearInterval(sleepInterval);
        isSleeping = false;
        minnieElement.classList.remove('sleep');
        minnieElement.classList.add('bounce');
        const randomWakeMessage = wakeMessages[Math.floor(Math.random() * wakeMessages.length)];
        showMessage(randomWakeMessage, 'success');
        enableButtons();
    }, 5000);
}

// Manger
function eating() {
    if (isDead) return;
    
    if (isSleeping) {
        showMessage("Minnie dort, elle ne peut pas manger ! üò¥", 'warning');
        return;
    }

    hangry += 25;
    energy += 5;
    
    // Messages vari√©s pour manger
    const eatMessages = [
        "Miam ! Minnie a bien mang√© ! üßÄ",
        "D√©licieux ! Minnie se r√©gale ! üòã",
        "Minnie d√©vore tout avec plaisir ! üçé",
        "Que c'est bon ! Minnie est satisfaite ! ü•®",
        "Minnie croque √† pleines dents ! ü•ï",
        "Un vrai festin pour Minnie ! üç∞"
    ];
    
    const randomMessage = eatMessages[Math.floor(Math.random() * eatMessages.length)];
    showMessage(randomMessage, 'success');
    
    // Animation
    minnieElement.classList.remove('shake', 'sleep', 'spin', 'dance', 'wiggle', 'jump', 'flip', 'heartbeat', 'rainbow');
    minnieElement.classList.add('pulse');
    setTimeout(() => minnieElement.classList.remove('pulse'), 1000);
    
    updateDisplay();
}

// Jouer
function playing() {
    if (isDead) return;
    
    if (isSleeping) {
        showMessage("Minnie dort, elle ne peut pas jouer ! üò¥", 'warning');
        return;
    }

    if (energy < 10) {
        showMessage("Minnie est trop fatigu√©e pour jouer ! üò©", 'warning');
        return;
    }

    happy += 20;
    energy -= 10;
    hangry -= 5;
    
    // Animations al√©atoires et messages vari√©s
    const playAnimations = ['shake', 'spin', 'dance', 'wiggle', 'jump', 'flip', 'heartbeat', 'rainbow'];
    const playMessages = [
        "Minnie s'amuse beaucoup ! üéÄ",
        "Hourra ! Minnie danse de joie ! üíÉ",
        "Minnie fait des pirouettes ! ‚ú®",
        "Que c'est amusant ! Minnie rigole ! üòÑ",
        "Minnie saute de bonheur ! üåü",
        "Minnie virevolte joyeusement ! üéà",
        "C'est la f√™te ! Minnie est ravie ! üéâ",
        "Minnie rayonne de bonheur ! üåà"
    ];
    
    // S√©lection al√©atoire
    const randomAnimation = playAnimations[Math.floor(Math.random() * playAnimations.length)];
    const randomMessage = playMessages[Math.floor(Math.random() * playMessages.length)];
    
    showMessage(randomMessage, 'success');
    
    // Animation al√©atoire
    minnieElement.classList.remove('bounce', 'sleep', 'pulse', 'shake', 'spin', 'dance', 'wiggle', 'jump', 'flip', 'heartbeat', 'rainbow');
    minnieElement.classList.add(randomAnimation);
    
    // Retour √† l'animation de base apr√®s l'animation
    const animationDuration = getAnimationDuration(randomAnimation);
    setTimeout(() => {
        minnieElement.classList.remove(randomAnimation);
        minnieElement.classList.add('bounce');
    }, animationDuration);
    
    updateDisplay();
}

// Obtenir la dur√©e de l'animation
function getAnimationDuration(animationName) {
    const durations = {
        'shake': 600,
        'spin': 1000,
        'dance': 1000,
        'wiggle': 800,
        'jump': 800,
        'flip': 1200,
        'heartbeat': 1000,
        'rainbow': 1500
    };
    return durations[animationName] || 800;
}

// D√©sactiver les boutons
function disableButtons() {
    if (boutonDormir) boutonDormir.disabled = true;
    if (boutonManger) boutonManger.disabled = true;
    if (boutonJouer) boutonJouer.disabled = true;
}

// Activer les boutons
function enableButtons() {
    if (boutonDormir) boutonDormir.disabled = false;
    if (boutonManger) boutonManger.disabled = false;
    if (boutonJouer) boutonJouer.disabled = false;
}

// D√©marrer le syst√®me de vie
function startLifeSystem() {
    setInterval(() => lifeSystem(), 5000);
}